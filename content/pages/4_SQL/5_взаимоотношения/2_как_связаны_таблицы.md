---
Title: Как связаны таблицы
Sort: 2
---

В начале этого курса мы рассказывали о преимуществах баз данных перед обычными электронными таблицами. Возможно, вы ещё не успели их заметить, и неудивительно. 

До сих пор вы работали только с одной таблицей: получали срез, группировали и сортировали данные. Особенности баз проявляются в случаях, когда данных много и их делят на несколько таблиц. И чем сильнее «дробят» информацию, тем лучше.  

Покажем на примере таблицы с заказами:

Номер заказа|	Фамилия|	Имя|	Отчество|	Адрес|	Телефон|	Товар|	Описание товара|	Цена|	Количество|
--|--|--|--|--|--|--|--|--|--|
1|	Иванов|	Николай|	Петрович|	г. Москва, Ленинский переулок, дом 3, кв. 26|	654-42-18|	Бритва Barber 3512|	Очень хорошая бритва|	2000|	1
2|	Иванов|	Николай|	Петрович|	г. Москва, Ленинский переулок, дом 3, кв. 26|	654-42-18|	Мультиварка Chef Т5|	Отлично готовит рис|	4000|	1
3|	Иванов|	Николай|	Петрович|	г. Москва, Ленинский переулок, дом 3, кв. 26|	654-42-18|	Квадрокоптер «Полёт»|	Взлетает на 100 метров|	3000|	4
4|	Иванов|	Николай|	Петрович|	г. Москва, Ленинский переулок, дом 3, кв. 26|	654-42-18|	Игрушка для кошки «Мяу-мяу»|	Кошкам нравится, дети не играют|	200|	2
5|	Куравкова|	Татьяна|	Алексеевна|	г. Рязань, ул. Юбилейная, дом 18, кв. 61|	805-66-88|	Дрель электрическая «Зубр»|	Быстро сверлит|	2500|	1
6|	Куравкова|	Татьяна|	Алексеевна|	г. Рязань, ул. Юбилейная, дом 18, кв. 61|	805-66-88|	Игрушка для кошки «Мяу-мяу»|	Кошкам нравится, дети не играют|	200|	4

На первый взгляд кажется, что с такой таблицей можно работать. Но присмотритесь внимательнее: в таблице много повторов. Данные покупателей дублируются, как и сами товары. Тут нет ошибки, ведь один человек может купить несколько предметов и один предмет могут купить несколько человек. 

Теперь представьте, что таблица со временем выросла до двух миллионов записей. Работать с ней уже не так удобно: она занимает больше места и искать информацию нужно дольше. К тому же если адрес покупателя или цена товара изменились, то вносить правки придётся несколько раз. 

### Три таблицы вместо одной

Повторяющиеся данные можно оптимизировать, разделив огромную таблицу на несколько таблиц поменьше.

#### Таблица с заказами 

Номер заказа|	Количество
--|--
1|	1
2|	1
3|	4
4|	2
5|	1
6|	4

#### Таблица с товарами

Товар|	Описание|	Цена
--| --| --
Бритва Barber 3512|	Очень хорошая бритва|	2000
Мультиварка Chef Т5|	Отлично готовит рис|	4000
Квадрокоптер «Полёт»|	Взлетает на 100 метров|	3000
Игрушка для кошки «Мяу-мяу»	|Кошкам нравится, дети не играют|	200
Дрель электрическая «Зубр»|	Быстро сверлит|	2500

#### Таблица с покупателями

Фамилия|	Имя|	Отчество|	Адрес|	Телефон
--|--|--|--|--
Иванов|	Николай|	Петрович|	г. Москва, Ленинский переулок, дом 3, кв. 26|	654-42-18
Куравкова|	Татьяна|	Алексеевна|	г. Рязань, ул. Юбилейная, дом 18, кв. 61|	805-66-88
<br>

Теперь информации в таблицах стало меньше. Но как узнать, кто что и когда покупал?

Выручит первичный ключ — назначим его таблицам с товарами и покупателями.
<br>

Идентификатор товара|	Товар|	Описание|	Цена
--|--|--|--
1|	Бритва Barber 3512|	Очень хорошая бритва|	2000
2|	Мультиварка Chef Т5|	Отлично готовит рис|	4000
3|	Квадрокоптер «Полёт»|	Взлетает на 100 метров|	3000
4|	Игрушка для кошки «Мяу-мяу»|	Кошкам нравится, дети не играют|	200
5|	Дрель электрическая «Зубр»|	Быстро сверлит|	2500
<br>

Идентификатор покупателя|	Фамилия|	Имя|	Отчество|	Адрес|	Телефон
--|--|--|--|--|--|
1|	Иванов|	Николай|	Петрович|	г. Москва, Ленинский переулок, дом 3, кв. 26|	654-42-18
2|	Куравкова|	Татьяна|	Алексеевна|	г. Рязань, ул. Юбилейная, дом 18, кв. 61|	805-66-88
<br>

Теперь свяжем таблицы между собой. В таблице с заказами укажем, кто и что покупал. Но вместо того, чтобы добавлять всю информацию, укажем только номера идентификаторов — покупателей и товаров.
<br>

Номер заказа|	Идентификатор покупателя|	Идентификатор товара|	Количество
--|--|--|--|
1|	1|	1|	1
2|	1|	2|	1
3|	1|	3|	4
4|	1|	4|	2
5|	2|	5|	1
6|	2|	4|	4
<br>

Таблица с заказами теперь не такая массивная. Может показаться, что пользоваться ей стало неудобно, ведь в ней остались одни числа. На самом деле информация из неё никуда не пропала. Например, чтобы проверить, кто покупал дрель «Зубр», нужно взять идентификатор `5` из таблицы с заказами и посмотреть, какому покупателю он соответствует. 

Таблица с заказами будет увеличиваться с каждым новым заказом. Так и таблицы с клиентами и товарами будут расти в случае, если появится новый покупатель или товар. Данные при этом дублироваться не будут.

Теперь покажем, как такие связи реализованы в базе данных интернет-магазина, с которой вы уже знакомы.

Вспомните таблицу `invoice`, которая хранит записи о заказах. В этой таблице есть данные и о пользователях: у каждого пользователя свой идентификатор, который хранится в поле `customer_id`. Но как узнать, что это за пользователь? Фамилии и имена хранятся в другой таблице — `client`. Если выгрузить заказы вместе с фамилией и именем пользователя, такая таблица получится информативнее.

### Как связывают таблицы

Повторимся: главное отличие базы от обычного хранилища данных в том, что в базе данных таблицы связаны между собой. Эти связи формируются с помощью ключей. Вы уже знакомы с первичным ключом — это уникальный признак записи. Кроме первичного ключа, существует внешний ключ — это поле, которое отсылает к первичному ключу другой таблицы. Другими словами, внешний ключ указывает на запись другой таблицы.

Объясним на примере. В таблице `invoice` поле `invoice_id` — первичный ключ, он уникальный и неповторимый. Поле `customer_id` хранит идентификаторы пользователей, но кто стоит за этими идентификаторами, пока неизвестно. 
<br>

invoice_id|	customer_id|	invoice_date
--|--|--
1|	2|	2009-01-01 00:00:00
2|	4|	2009-01-02 00:00:00
3|	8|	2009-01-03 00:00:00
4|	14|	2009-01-06 00:00:00
5|	23|	2009-01-11 00:00:00
6|	37|	2009-01-19 00:00:00
7|	38|	2009-02-01 00:00:00
8|	40|	2009-02-01 00:00:00
9|	42|	2009-02-02 00:00:00
10|	46|	2009-02-03 00:00:00
<br>

Нужные данные есть в таблице `client`. В этой таблице первичным ключом будет поле `customer_id`. Теперь можно сравнить две таблицы и понять, что покупателя с идентификатором `8`, который сделал заказ 3 января 2009 года, зовут Daan Peeters.  

customer_id|	first_name|	last_name
--|--|--
1|	Luís|	Gonçalves
2|	Leonie|	Köhler
3|	François|	Tremblay
4|	Bjørn|	Hansen
5|	František|	Wichterlová
6|	Helena|	Holý
7|	Astrid|	Gruber
8|	Daan|	Peeters
9|	Kara|	Nielsen
10|	Eduardo|	Martins
<br>

Подытожим: поле `customer_id` встречается в таблицах `invoice` и `client`, и с его помощью удалось соединить две таблицы. 
Для таблицы `invoice` поле `customer_id` будет внешним ключом, который отсылает ко второй таблице — `client`. В таблице `invoice` идентификатор пользователя может повторяться, ведь один и тот же покупатель может оформить несколько заказов. Но в таблице `client` значения в поле `customer_id` не повторяются — для каждого пользователя только одна запись.


<img src="%base_url%/images/sql3_1632170224.jpg"/>
<br><br>

### Подведём итоги:

- Хранить все данные в одной таблице непрактично. Лучше разделить данные на несколько таблиц и связывать их между собой. Искать информацию будет проще и быстрее.
- Таблицы можно связать ключами — первичными и внешними. Например, всем клиентам можно назначить идентификаторы, чтобы с их помощью связать покупателя с заказом.
- Таблица, состоящая из одних чисел-идентификаторов, кажется нечитаемой, но средствами SQL её можно привести к удобному виду. Как это сделать, расскажем в следующих уроках.