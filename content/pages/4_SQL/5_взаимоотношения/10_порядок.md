---
Title: Порядок выполнения операторов
Sort: 10
---

Вы уже научились присоединять таблицы и назначать псевдонимы, но, чтобы не совершать ошибок, нужно знать порядок выполнения операторов.

Вы написали не один запрос и знаете, какой оператор указывать в начале, а какой — в конце. Повторим основные правила:
- Запрос обычно начинают с `SELECT`, затем пишут `FROM`, а за ними следуют разные `WHERE` и `GROUP BY`.
-Некоторые операторы пишут в самом конце запроса, например `ORDER BY` и `LIMIT`. Если есть оба оператора — `LIMIT` нужно указать последним.
-Оператор `HAVING` всегда указывают после `GROUP BY`, но никогда перед ним.

Эти правила вам должны быть знакомы, но порядок выполнения операторов может быть совсем другим.

Операторы действуют в таком порядке:
1. Сначала нужно определить, откуда брать данные, поэтому первым идёт оператор `FROM`. На этом же этапе объединяются таблицы операторами `JOIN` и назначаются для них псевдонимы. Важно учесть, что присоединение предшествует фильтрации и группировке. Это означает, что большие таблицы будут объединяться очень долго. Как решить такую проблему, вы узнаете в следующей теме.
1. Данные выбраны, и наступает очередь оператора `WHERE`. Остаются только те данные, которые соответствуют условиям.
1. После срезов данные группируются оператором `GROUP BY` и подсчитываются агрегирующими функциями. Обратите внимание, что WHERE предшествует `GROUP BY`, и это не позволяет сделать срез по группам. В момент получения среза данные ещё не сгруппировались.
1. Теперь наступает очередь `HAVING` — отбираются уже сгруппированные данные.
1. Только на этом этапе происходит выбор данных с помощью оператора `SELECT`, а полям в итоговой таблице присваиваются псевдонимы. По этой причине псевдонимы нельзя использовать после `WHERE` и `HAVING` — они ещё не назначены. В некоторых СУБД псевдонимы нельзя использовать и после `GROUP BY`. В PostgreSQL есть расширение, которое устраняет эту проблему.
1. После `SELECT` срабатывает ключевое слово `DISTINCT`, которое отбирает уникальные значения.
1. Нужные данные отобраны, и происходит сортировка. Оператор ORDER BY действует предпоследним.
1. Замыкающим будет оператор `LIMIT`.