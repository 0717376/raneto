---
Title: Условная конструкция с оператором CASE
Sort: 9
---


Вы уже умеете писать условия и отбирать нужные записи оператором `WHERE`. Например, такой запрос выведет заказы на сумму меньше 5 долларов:

```SQL
SELECT total
FROM invoice
WHERE total < 5; 
```

total|
|--
1.98
3.96
0.99

Чтобы вывести информацию об остальных заказах, понадобится новый запрос. Но сравнивать две выдачи будет неудобно.

Поле `total` хранит много количественных данных, но как их сравнить? Если брать каждое значение и сравнивать с другими, сложно добиться понятных результатов. Такие данные легче анализировать с помощью категорий. Тогда можно сравнивать не отдельные значения, а группы данных.

В поле `total` можно выделить категории в зависимости от суммы заказа. Заказ на сумму меньше 5 долларов будет «маленьким», от 5 до 10 долларов — «средним», а заказ на сумму 10 долларов и больше — «крупным». 

Оператор `WHERE` с такой задачей не справится, ведь разделить на категории нужно одним запросом.  В SQL запрос с несколькими условиями пишут с помощью оператора `CASE`. 

Условные конструкции в SQL состоят из проверяемого условия и результата, который возвращается в зависимости от условия. Так выглядит синтаксис условных конструкций в SQL: 
- начало конструкции обозначают оператором `CASE`;
- после оператора `WHEN` пишут условие;
- после оператора `THEN` — возвращаемый результат;
- а в конце указывают оператор `END`.

Теперь можно разделить заказы на категории:

```SQL
SELECT total,
       CASE
           WHEN total < 5 THEN 'маленький'
           WHEN total >= 5 AND total < 10 THEN 'средний'
           WHEN total >= 10 THEN 'крупный'
       END
FROM invoice
LIMIT 10; 
```

total|	case
--|--
1.98|	маленький
3.96|	маленький
5.94|	средний
8.91|	средний
13.86|	крупный
0.99|	маленький
1.98|	маленький
1.98|	маленький
3.96|	маленький
5.94|	средний

Конструкция с оператором `CASE` выводит новое поле с результатом проверки условий. Это поле появляется только в выдаче, а оригинальная таблица остаётся без изменений. 

Если значение в проверяемом поле не удовлетворяет ни одному условию, результатом будет `NULL`. Исключив из запроса выражение для маленьких заказов, можно получить такую таблицу:

```SQL
SELECT total,
       CASE
           WHEN total >= 5 AND total < 10 THEN 'средний'
           WHEN total >= 10 THEN 'крупный'
       END
FROM invoice
LIMIT 10; 
```

total|	case
--|--
1.98|	[null]
3.96|	[null]
5.94|	средний
8.91|	средний
13.86|	крупный
0.99|	[null]
1.98|	[null]
1.98|	[null]
3.96|	[null]
5.94|	средний

Все условия необязательно прописывать. Условную конструкцию можно дополнить выражением с оператором `ELSE`: после оператора указывают результат на случай, если ни одно условие не выполнено.

```SQL
SELECT total,
       CASE
           WHEN total >= 5 AND total < 10 THEN 'средний'
           WHEN total >= 10 THEN 'крупный'
           ELSE 'маленький'
       END
FROM invoice
LIMIT 10; 
```

total|	case
--|--
1.98|	маленький
3.96|	маленький
5.94|	средний
8.91|	средний
13.86|	крупный
0.99|	маленький
1.98|	маленький
1.98|	маленький
3.96|	маленький
5.94|	средний

Важный момент — условия в запросе проверяются по порядку. Если условие выполнено, сразу выводится соответствующий результат, а остальные условия не проверяются.

Обратите внимание на таблицу, которая получилась в результате такого запроса:

```SQL
SELECT total,
       CASE
           WHEN total >= 5 THEN 'средний'
           WHEN total >= 10 THEN 'крупный'
           ELSE 'маленький'
       END
FROM invoice
LIMIT 10; 
```

total|	case
--|--
1.98|	маленький
3.96|	маленький
5.94|	средний
8.91|	средний
13.86|	средний
0.99|	маленький
1.98|	маленький
1.98|	маленький
3.96|	маленький
5.94|	средний

Заказу в пятой записи присвоена категория `средний`, а не `крупный`. Дело в том, что проверяемое значение в поле `total` удовлетворяет двум условиям сразу. Первое условие было выполнено, поэтому остальные условия не проверялись. Такой ситуации можно избежать, если правильно указать границы диапазона.

