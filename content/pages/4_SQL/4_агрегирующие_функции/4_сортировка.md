---
Title: Сортировка данных
Sort: 4
---

Данные проще анализировать отсортированными. Сортировка позволит выгрузить «топовые» значения от большего к меньшему или наоборот, например топ-10 самых популярных треков или топ-5 самых невовлечённых пользователей. 

В SQL сортируют значения в полях с любым типом данных. Поля с числовым типом данных можно отсортировать по возрастанию или убыванию. Так же можно сортировать дату и время. Поля с символьными данными сортируют в **лексикографическом порядке** по возрастанию и наоборот. 

Для сортировки данных в SQL используют оператор `ORDER BY`. Его пишут в самом конце запроса, после него можно указать только оператор `LIMIT`. 

Разберём синтаксис оператора `ORDER BY` на примере. В прошлом уроке вы выгружали таблицу с выручкой по городам. Запрос вернул такой результат:

```sql
SELECT billing_city,
       SUM(total),
             COUNT(total),
             AVG(total)
FROM invoice
WHERE billing_country = 'USA'
GROUP BY billing_city; 
```

billing_city|	sum|	count|	avg
-- | -- | -- | --
Reno|	37.62|	7|	5.3742857142857143
New York|	37.62|	7|	5.3742857142857143
Salt Lake City|	43.62|	7|	6.2314285714285714
Orlando|	39.62|	7|	5.660000000000000
Fort Worth|	47.62|	7|	6.8028571428571429
Chicago|	43.62|	7|	6.2314285714285714
Mountain View|	77.24|	14|	5.5171428571428571
Madison|	42.62|	7|	6.0885714285714286
Cupertino|	38.62|	7|	5.5171428571428571
Redmond|	39.62|	7|	5.660000000000000
Boston|	37.62|	7|	5.3742857142857143
Tucson|	37.62|	7|	5.3742857142857143

Чтобы определить, в каком городе самое большое значение средней выручки, придётся самостоятельно сравнивать значения. В выдаче 12 записей — не очень много, но таблица станет понятнее, если данные отсортировать. 

```sql
SELECT billing_city,
       SUM(total),
             COUNT(total),
             AVG(total)
FROM invoice
WHERE billing_country = 'USA'
GROUP BY billing_city
ORDER BY AVG(total); 
```

billing_city|	sum|	count|	avg|
-- | -- | -- | --
Boston|	37.62|	7|	5.3742857142857143
Reno|	37.62|	7|	5.3742857142857143
Tucson|	37.62|	7|	5.3742857142857143
New York|	37.62|	7|	5.3742857142857143
Mountain View|	77.24|	14|	5.5171428571428571
Cupertino|	38.62|	7|	5.5171428571428571
Redmond|	39.62|	7|	5.660000000000000
Orlando|	39.62|	7|	5.660000000000000
Madison|	42.62|	7|	6.0885714285714286
Salt Lake City|	43.62|	7|	6.2314285714285714
Chicago|	43.62|	7|	6.2314285714285714
Fort Worth|	47.62|	7|	6.8028571428571429

Стало лучше. Теперь данные отсортированы по возрастанию значения средней выручки. 

По умолчанию оператор `ORDER BY` сортирует данные от меньшего к большему. Чтобы изменить порядок сортировки вручную, после названия поля указывают ключевое слово `DESC`: тогда данные будут отсортированы по убыванию. Если указать `ASC`, данные будут отсортированы по возрастанию — так же, как и по умолчанию. 

Теперь можно составить топ-5 городов по значению средней выручки. В таблицу войдут название города и средняя выручка, отсортированная по убыванию. Запрос выгрузит первые пять записей.

```sql
SELECT billing_city,
       AVG(total)
FROM invoice
WHERE billing_country = 'USA'
GROUP BY billing_city
ORDER BY AVG(total) DESC
LIMIT 5; 
```

billing_city|	avg
--| -- 
Fort Worth|	6.8028571428571429
Salt Lake City|	6.2314285714285714
Chicago|	6.2314285714285714
Madison|	6.0885714285714286
Orlando|	5.660000000000000