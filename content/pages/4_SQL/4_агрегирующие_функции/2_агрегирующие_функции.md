---
Title: Агрегирующие функции
Sort: 2
---

Агрегирующие функции выполняют вычисления на наборе значений, а возвращают одно.

Основные агрегирующие функции в SQL:
- `SUM(поле)` возвращает сумму значений в поле;
- `AVG(поле)` находит среднее арифметическое для значений в поле;
- `MIN(поле)` возвращает минимальное значение в поле;
- `МАХ(поле)` возвращает максимальное значение в поле;
- `COUNT(*)` выводит количество записей в таблице, а `COUNT(поле)` — количество записей в поле.

Теперь можно посчитать суммарную выручку, а также найти самый маленький и самый крупный заказы.

```sql
SELECT SUM(total),
       MIN(total),
       MAX(total)
FROM invoice;
```

sum | min	| max
-- | -- | --
2328.60|	0.99|	25.86

Агрегирующие функции можно сочетать с математическими, например, можно округлить среднюю сумму заказа до двух чисел после запятой.

```sql
SELECT ROUND(AVG(total), 2)
FROM invoice; 
```

round |
--|
5.65

Функцию `COUNT`, в отличие от других, можно использовать и для всей таблицы. 

```sql
-- так считают записи в таблице
SELECT COUNT(*)
FROM invoice;
```

count| 
--|
412

Такой запрос выведет количество записей в поле `billing_postal_code`. 
```sql
-- так считают записи в поле
SELECT COUNT(billing_postal_code)
FROM invoice; 
```

count|
--|
384

В данных могут быть не только пропуски, но и повторы. Их можно учесть с помощью ключевого слова `DISTINCT`. Оно возвращает уникальные значения. 

<img src="%base_url%/images/15_2880border_1635947121.png">
<br><br>

Такой запрос выведет первые пять уникальных значений в поле `billing_country`.

```sql
SELECT DISTINCT billing_country 
FROM invoice
LIMIT 5; 
```

billing_country|
--|
Argentina
Spain
Italy
Hungary
India

`DISTINCT` — это не функция, которая принимает аргументы в виде названий полей. Если перечислить несколько полей после `DISTINCT`, запрос выведет все уникальные комбинации значений в этих полях.

```sql
SELECT DISTINCT customer_id,
                billing_country
FROM invoice
LIMIT 10; 
```

customer_id|	billing_country
--| --
2|	Germany
4|	Norway
8|	Belgium
14|	Canada
23|	USA
37|	Germany
38|	Germany
40|	France
42|	France
46|	Ireland

В получившейся таблице в поле `billing_country` некоторые страны повторяются. Дело в том, что с помощью `DISTINCT` можно вывести именно комбинации уникальных значений: идентификаторов и стран. 

Ключевое слово `DISTINCT` можно сочетать с агрегирующими функциями. Например, уникальные значения можно посчитать. Здесь пригодится функция `COUNT`.

```sql
SELECT COUNT(DISTINCT billing_country)
FROM invoice; 
```

count| 
--|
24

Чтобы посчитать заказы для каждой уникальной страны, мы могли бы написать такой запрос:

```sql
SELECT DISTINCT billing_country,
       COUNT(total)
FROM invoice; 
```

Но он выдаст ошибку, ведь так `DISTINCT` с агрегирующими функциями сочетать нельзя. Это не недостаток SQL — просто для таких задач используют другие инструменты. О них расскажем немного позже.