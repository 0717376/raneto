---
Title: Масштабный куб
Sort: 4
---

В прошлых уроках вы изучили стили архитектуры ПО. В этом уроке вы узнаете, как стили архитектуры помогают приложению справляться с увеличением числа пользователей, транзакций и серверов.

### Масштабирование

Вы узнали из предыдущих уроков, что монолитные стили и, в частности, многослойная архитектура отлично подходят для начала разработки приложений. Ведь на первом этапе приложение, как правило, небольшое и простое.

По мере прибавления функций и пользователей монолиты становятся неудобны для проектирования, разработки и сопровождения. А ещё монолиты зачастую не справляются с увеличением количества запросов, объёма данных и сетевого трафика.

Поэтому архитектор ПО и команда разработки выбирают распределённые стили архитектуры, масштабируя монолитное приложение.

**Масштабируемость (Scalability)** — это возможность приложения расти и обслуживать больше пользователей, данных, серверов, географических точек, транзакций, сетевого трафика, операций поиска и других сервисов без снижения его производительности и с сохранением корректности его работы.

### Масштабный куб

Мартин Эббот (Martin Abbott) и Майкл Фишер (Michael Fisher) в своей книге «Искусство масштабирования» (The Art of Scalability) представили три подхода к масштабированию приложений в виде куба, расположенного в трёхмерной системе координат.

<img src="%base_url%/images/S8-T3-L4-00_1674216102.png"/>
<br><br>

Три оси пересекаются в точке с координатами x = 0, y = 0 и z = 0. В этой точке приложение монолитно и развёртывается на единственном сервере. Его можно масштабировать с помощью более мощного и быстрого аппаратного обеспечения, но только до определённого предела. Кроме того, такое приложение сложно разрабатывать. 

Поэтому его нужно масштабировать с помощью одного, двух или сразу трёх подходов:
- **Копирование приложения (ось X)** 

    Создание копий приложения и равномерное распределение запросов между ними.
- **Разбивка по функциям (ось Y)** 

    Разделение приложения на сервисы, каждый из которых выполняет только часть функций.
- **Разбивка по данным (ось Z)** 

    Создание копий приложения, каждая из которых хранит только определённое **подмножество данных (партицию)**, и распределение запросов между ними на основании значений их атрибутов.

<img src="%base_url%/images/S8-T3-L4-01_1674216148.png"/>
<br><br>


### Копирование приложения (ось X)

Масштабирование по оси X используется для увеличения производительности приложений с монолитной архитектурой.

При таком масштабировании одно приложение дублируется несколько раз. Каждая копия приложения развёртывается, как правило, на отдельном сервере — физическом или виртуальном. Она работает независимо от других копий.

Копии приложения называют экземплярами или инстансами (Instances) приложения. Они представляют собой частный случай реализации определённого приложения.

Между клиентом и серверами с экземплярами добавляют **балансировщик нагрузки (Load Balancer)**. Он представляет собой программу, которая равномерно распределяет запросы клиента между действующими копиями приложения, чтобы оптимизировать их работу и сократить время обработки запроса.

Балансировщик последовательно перенаправляет полученные от клиента запросы сначала экземпляру 1, потом экземпляру 2, затем экземпляру 3, снова экземпляру 1 и так далее.

<img src="%base_url%/images/S8-T3-L4-02_1674216187.png"/>
<br><br>

Чтобы лучше понять, как работают все три подхода к масштабированию, рассмотрим их на примере производства автомобилей. Как приложение выполняет запросы пользователя, так и автомобильные заводы выполняют заказы клиентов на машины. 

Если завод «монолитный», он собирает все виды автомобилей: внедорожник, кабриолет и седан. Если клиентов станет слишком много, придётся построить ещё один завод, а потом ещё один, чтобы справляться с нагрузкой и не заставлять пользователей долго ждать своего автомобиля. 

Как только заводов становится больше одного, появляется необходимость в управляющей структуре, которая будет распределять заказы между заводами и следить, чтобы они были загружены равномерно. Управление в данном случае выполняет роль «балансировщика» заказов.

<img src="%base_url%/images/S8-T3-L4-03_1674216237.png"/>
<br><br>

### Разбивка по данным (ось Z)

Масштабирование по оси Z решает задачи по обработке возросшего количества запросов и данных.

При таком масштабировании монолитное приложение тоже «клонируют», но, в отличие от масштабирования по оси X, каждый получившийся экземпляр отвечает только за подмножество данных исходного приложения (партицию).

В данном случае запросы между экземплярами распределяет **маршрутизатор (Router)**. Он представляет собой программу, которая перенаправляет запросы от клиента экземплярам приложения по определённым правилам.

Маршрутизатор — это специализированное ПО, передающее (маршрутизирующее) запрос между серверами на основании заранее установленных правил маршрутизации.

Правила маршрутизации указывают на то, какому экземпляру нужно перенаправить запрос клиента, на основании значений одного или нескольких атрибутов запроса. Каждому экземпляру приложения будет соответствовать свой диапазон значений.

В качестве правил маршрутизации могут быть выбраны значения идентификаторов, имён сущностей.

<img src="%base_url%/images/S8-T3-L4-04_1674216281.png"/>
<br><br>

В примере с заводами масштабирование по оси Z предполагает, что каждый завод собирает только определённый тип автомобиля: внедорожник, кабриолет или седан. При оформлении заказа отдел работы с заказами (маршрутизатор) обязательно запрашивает параметр: необходимый тип автомобиля. В зависимости от выбранного типа, заказ пользователя маршрутизируется на завод, производящий этот тип автомобилей.

<img src="%base_url%/images/S8-T3-L4-05_1674216338.png"/>
<br><br>

### Разбивка по функциям (ось Y)

Масштабирование по осям X и Z повышает производительность и отказоустойчивость приложения. Но, как вы уже знаете из урока про монолитную архитектуру, у этого архитектурного стиля есть существенные недостатки. По мере развития монолитного приложения возрастает сложность его разработки и сопровождения, потому что программный код становится слишком объёмным для понимания разработчиками.

Для решения проблемы используется масштабирование по оси Y — декомпозиция по функциям. При таком подходе монолитное приложение разбивают на набор сервисов.

Как вы помните, сервис — это небольшая программа, которая реализует ограниченный перечень функций, например управление заказами, клиентами и так далее. Сервисы — это результат разделения архитектуры ПО по предметным областям.

Сервис, который масштабируется по оси Y, можно также в дальнейшем масштабировать по осям X и Z.

<img src="%base_url%/images/S8-T3-L4-06_1674216583.png"/>
<br><br>

Чтобы масштабировать завод по производству автомобилей по оси Y, нужно разделить один большой завод на более мелкие производства — цеха, отвечающие за отдельные части машины: руль, колёса, кузов. А ещё нужны специальные цеха, которые будут собирать автомобиль из деталей.

<img src="%base_url%/images/S8-T3-L4-07_1674216694.png"/>
<br><br>

Эти цеха могут находиться в разных городах и странах. Если определённых деталей требуется больше, чем может произвести один цех, можно построить ещё один цех. 

Такая организация производства делает его более устойчивым к сбоям поставок. Например, если в цехе по производству кузова кабриолета произойдёт авария и производство остановится, это не повлияет на поставки внедорожников и седанов.

### Подведём итоги

**Масштабируемость** — это возможность приложения расти и обслуживать больше пользователей, данных, серверов, географических точек, транзакций, сетевого трафика, операций поиска и других сервисов без снижения его производительности и с сохранением корректности его работы.

Три подхода к масштабированию приложений можно представить в виде куба, расположенного в трёхмерной системе координат. Эту модель называют **масштабным кубом**.

В точке пересечения трёх осей приложение монолитно и развёртывается на единственном сервере. В соответствии с масштабным кубом, такое приложение можно масштабировать с помощью одного, двух или сразу трёх подходов:
- **Копирование приложения (ось X)** 

    Создание копий (экземпляров) приложения и равномерное распределение запросов между ними.
- **Разбивка по функциям (ось Y)** 

    Разделение приложения на сервисы, каждый из которых выполняет только часть функций.
- **Разбивка по данным (ось Z)** 

    Создание копий приложения, каждая из которых хранит только определённое подмножество данных, и распределение запросов между ними на основании значений их атрибутов.

Используя масштабный куб, архитектор ПО и команда разработки могут принимать решения об изменениях, которые нужно внести в архитектуру ПО.