---
Title: Уровни ER-моделей
Sort: 3
---

Вы уже знаете, что такое модели данных и зачем их составляют. В этом уроке мы рассмотрим ER-модель — один из видов моделей данных, с которого, как правило, начинается разработка системы. Вы узнаете, из каких этапов состоит процесс создания ER-моделей, для чего они нужны и кто помогает системному аналитику составлять их.

Начиная работу над новым проектом, мы, как правило, плохо знакомы с предметной областью. Поэтому резонно идти от общего к частному: сначала в целом сформировать представление о предметной области, затем углубиться в детали. Такой процесс можно разбить на три этапа. Каждому из них соответствует определённый уровень модели. Их ещё называют тремя уровнями абстракции.

### Уровни ER-моделей

ER-модели, с которых обычно начинается разработка системы, так же, как и остальные модели данных, создаются в три этапа. Сначала системный аналитик составляет модель на концептуальном уровне (первый этап), затем на логическом уровне (второй этап) и после — на физическом (это третий, заключительный этап).

Каждый из уровней дополняет модель, у каждого из них своя цель, аудитория и степень детализации.
- Основная цель **концептуального уровня** — сформировать представление о том, как бизнес воспринимает информацию, с которой работает: какие сущности он выделяет, что они из себя представляют, какие названия он им даёт, как эти сущности связаны между собой. Другими словами, цель этого уровня — понять суть предметной области, выделить основные сущности и связи.
  
  Системный аналитик составляет ER-модель концептуального уровня вместе с заинтересованными лицами, которые разбираются в предметной области, — заказчиками, пользователями, экспертами (специалистами, у которых есть специфические знания, опыт и квалификация), владельцами продукта и бизнес-аналитиками.
  
  Аудитория концептуальной модели — упомянутые заинтересованные лица и команда разработки. Системные аналитики показывают модель заинтересованным лицам, чтобы убедиться, что все друг друга поняли и представление о предметной области верно. Команда разработки может использовать концептуальную ER-модель для того, чтобы лучше понимать предметную область и говорить на одном языке с заинтересованными лицами.
- На **логическом уровне** системный аналитик уточняет ER-модель концептуального уровня — обогащает сущности атрибутами (характеристиками). Выделив характеристики, системный аналитик может обнаружить, что количество сущностей в ER-модели нужно изменить.
  
  Целевая аудитория логического уровня включает заинтересованных лиц, они помогают с уточнением атрибутов сущности. Аудитория логического уровня также включает в себя архитекторов баз данных и бизнес-аналитиков, которые могут помочь с разработкой ER-модели или предложат, как её доработать.
- **Физический уровень** предназначен для подготовки ER-модели к реализации в конкретной СУБД. Иначе говоря, цель физического уровня ER-модели — описать структуру будущей базы данных. Физическая модель рассматривает оптимизацию хранения данных и скорость их извлечения. В первом случае речь идёт о сокращении объёма используемого дискового пространства, во втором — об увеличении скорости получения данных из базы.
  
  Целевая аудитория физического уровня — архитекторы баз данных и разработчики, которые, как правило, самостоятельно составляют физическую ER-модель. Физический уровень — наиболее детальный, поэтому для его составления нужны углублённые технические знания. Системный аналитик помогает команде разработки в составлении физической ER-модели, отвечая на уточняющие вопросы.

<img src="%base_url%/images/pyramid_1661881284.png"/>
<br><br>

### Элементы уровней ER-моделей

Теперь определим, какие элементы включает в себя каждый из уровней ER-модели.

#### Концептуальный уровень

**Концептуальная модель данных** (Conceptual Data Model) — это описание важных для предметной области понятий и связей между ними.

Концептуальная ER-модель не зависит от конкретной системы управления базами данных (СУБД). Её можно применять для создания словаря, описывающего бизнес-информацию и связи внутри этой информации.

Концептуальная ER-модель — это представление самого высокого уровня абстракции. Она содержит наименьшее количество деталей и отражает общий объём модели, то есть количество сущностей и связей в ней.

Рассмотрим на примере. Предположим, вы хотите сделать смузи. Его можно приготовить практически из любых фруктов и овощей. Но вы предпочитаете зелёный смузи, и для него потребуется несколько яблок и одно киви.

Предметная область в этом примере — приготовление зелёного смузи, а понятия, которые мы включили в описание концептуальной модели, — «яблоко», «киви», «смузи». Связи между ними мы выделили курсивом: для приготовления одного зелёного **смузи** потребуется несколько **яблок** и одно **киви**.

<img src="%base_url%/images/4-sprint-info_1661881475.png"/>
<br><br>

Концептуальный уровень — как правило, первый этап в составлении ER-модели, но в небольших системах, если у них простая и понятная структура (мало сущностей и связей), создавать ER-модель можно и с логического уровня.

#### Логический уровень

**Логическая модель данных** (Logical Data Model) — это описание важных для предметной области понятий, их атрибутов и связей между понятиями.

Логическая модель данных тоже не зависит от конкретной СУБД. В логической ER-модели, кроме сущностей и связей между ними, системный аналитик определяет основные атрибуты, а также первичные ключи. Следовательно, логическая модель содержит больше деталей, чем концептуальная. 

Рассмотрим понятие «яблоко». Рецепт зелёного смузи, например, требует, чтобы мы использовали свежие, сладкие яблоки среднего размера. Это значит, что атрибутами (характеристиками) сущности «яблоко» для этого примера могут быть «дата сбора урожая», «вкус», «размер».

Набор атрибутов и их качественный состав отличают одно понятие от другого. Качественный состав — это то, как мы определяем характеристику. Если рассматривать атрибут «размер», мы можем подразумевать высоту, ширину или просто слово «большой». Каждый атрибут должен быть задействован хотя бы в одном из процессов.

Рассматривая понятие «киви», мы заметим, что атрибуты для двух сущностей («яблоко» и «киви») совпадают, ведь киви тоже должно быть свежим, сладким и средним по размеру. В этом случае мы можем обобщить понятия «яблоко» и «киви»: и то и другое — «ингредиент». Таким образом, после выделения характеристик на логическом уровне изменилось количество сущностей: две сущности («яблоко» и «киви») превратились в одну.

<img src="%base_url%/images/4-sprint-info--57_1661881495.png"/>
<br><br>

Мы уже знаем, что для приготовления одного смузи требуется несколько ингредиентов (яблоки и киви). Предположим, что один ингредиент можно использовать для приготовления только одного смузи, тогда сущность «смузи» становится родительской по отношению к сущности «ингредиент».

Атрибуты «уникальный номер ингредиента» и «уникальный номер приготовленного смузи» (в нашем примере это порядковые номера) будут первичными ключами для сущностей «ингредиент» и «смузи», соответственно.

<img src="%base_url%/images/smothie_1661881513.png"/>
<br><br>

Логическая модель необходима для описания атрибутов сущностей, определения первичных ключей и уточнения числа сущностей — всё это подготовительные действия перед составлением физической модели, которая ляжет в основу будущей базы данных.

#### Физический уровень

**Физическая ER-модель** — это описание того, как логическая ER-модель может быть разработана с помощью определённой технологии. Например, мы составляем разные физические ER-модели для разных реляционных СУБД (PostgreSQL, Oracle Database, MS SQL и других). То есть одной логической ER-модели могут соответствовать несколько физических ER-моделей.

Для построения физической ER-модели сущности в будущей базе данных должны рассматриваться как таблицы. Для каждой таблицы нужно определить имя на английском языке.

Атрибуты сущностей в будущей базе данных должны рассматриваться как поля таблиц. Для каждого поля нужно определить: 
- Имя на английском языке.
- Тип данных и размерность.
- Допустимость пустых значений.
- Значение по умолчанию (если требуется).
- Правила валидации значений (если требуется).

Связи между таблицами нужно отражать через внешний ключ. 

Вернёмся к смузи. В физической модели данных этой сущности будет соответствовать таблица smoothie. В ней мы будем хранить экземпляры сущности «смузи», то есть строки, соответствующие каждому приготовленному напитку. Полями таблицы smoothie могут быть столбцы id (уникальный номер), created_at (день приготовления) и volume (объём). Для каждого поля мы должны определить тип данных, например: id — числа, created_at — текст, volume — текст.

Ещё нам нужно определить, какие поля можно оставить пустыми, какие — нет, нужно ли для некоторых полей устанавливать значения по умолчанию и по каким принципам валидировать значения (система выдаст ошибку, если значения не будут удовлетворять определённым требованиям): например, мы можем установить правило, что объём напитка не может быть меньше 100 мл.

<img src="%base_url%/images/4-sprint-png_1661881536.png"/>
<br><br>

Подведём итоги

В этом уроке вы познакомились с тремя уровнями ER-модели (тремя уровнями абстракции):
- концептуальным,
- логическим,
- физическим.

У каждого из уровней своя цель, аудитория и степень детализации.
- **Концептуальный уровень** нужен для того, чтобы сформировать представление о том, как бизнес воспринимает информацию, с которой работает. Целевая аудитория на этом уровне — заинтересованные лица и команда разработки. Концептуальная ER-модель состоит из понятий и связей между ними.
- **Логический уровень** описывает атрибутный (атрибут — характеристика) состав сущностей и первичные ключи. Логическая ER-модель уточняет число сущностей, которые системный аналитик выделил на концептуальном уровне. Целевая аудитория этого уровня — архитекторы баз данных, бизнес-аналитики и иногда заинтересованные лица.
- **Физический уровень** — наиболее детальное описание ER-модели. Он предназначен для подготовки ER-модели к реализации в конкретной СУБД. Целевая аудитория — архитекторы баз данных и разработчики. Они, как правило, самостоятельно составляют физическую ER-модель, а системный аналитик помогает им в этом.

Элементы каждого уровня ER-модели:

<img src="%base_url%/images/table_1662462349.png"/>
<br><br>